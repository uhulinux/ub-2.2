From 4c0ae23c0e7a648f0ab2d69e69231e8b1dd43d7a Mon Sep 17 00:00:00 2001
From: Martin Wimpress <code@flexion.org>
Date: Wed, 29 Apr 2015 19:47:18 +0100
Subject: [PATCH] Added Maximus configuration. Slight refactoring. Stub for
 panel layout backup.

---
 data/mate-tweak.ui | 210 +++++++++++++++++++++++++++++++++++------------------
 mate-tweak         | 112 +++++++++++++++-------------
 2 files changed, 202 insertions(+), 120 deletions(-)

diff --git a/data/mate-tweak.ui b/data/mate-tweak.ui
index ffd017b..8c7943b 100644
--- a/data/mate-tweak.ui
+++ b/data/mate-tweak.ui
@@ -2,6 +2,59 @@
 <interface>
   <!-- interface-requires gtk+ 3.10 -->
   <!-- interface-naming-policy toplevel-contextual -->
+  <object class="GtkListStore" id="model1">
+    <columns>
+      <!-- column-name gchararray -->
+      <column type="gchararray"/>
+    </columns>
+    <data>
+      <row>
+        <col id="0" translatable="yes">Left</col>
+      </row>
+      <row>
+        <col id="0" translatable="yes">Left (Inverted)</col>
+      </row>
+      <row>
+        <col id="0" translatable="yes">Right</col>
+      </row>
+    </data>
+  </object>
+  <object class="GtkListStore" id="model2">
+    <columns>
+      <!-- column-name gchararray -->
+      <column type="gchararray"/>
+    </columns>
+    <data>
+      <row>
+        <col id="0" translatable="yes">Test</col>
+      </row>
+    </data>
+  </object>
+  <object class="GtkListStore" id="model3">
+    <columns>
+      <!-- column-name gchararray -->
+      <column type="gchararray"/>
+    </columns>
+    <data>
+      <row>
+        <col id="0" translatable="yes">Test</col>
+      </row>
+    </data>
+  </object>
+  <object class="GtkListStore" id="model4">
+    <columns>
+      <!-- column-name gchararray -->
+      <column type="gchararray"/>
+    </columns>
+    <data>
+      <row>
+        <col id="0" translatable="yes">compiz</col>
+      </row>
+      <row>
+        <col id="0" translatable="yes">marco</col>
+      </row>
+    </data>
+  </object>
   <object class="GtkWindow" id="main_window">
     <property name="visible">True</property>
     <property name="can_focus">False</property>
@@ -97,7 +150,6 @@
                             <property name="can_focus">True</property>
                             <property name="receives_default">False</property>
                             <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                            <property name="use_action_appearance">False</property>
                             <property name="draw_indicator">True</property>
                           </object>
                           <packing>
@@ -113,7 +165,6 @@
                             <property name="can_focus">True</property>
                             <property name="receives_default">False</property>
                             <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                            <property name="use_action_appearance">False</property>
                             <property name="draw_indicator">True</property>
                           </object>
                           <packing>
@@ -129,7 +180,6 @@
                             <property name="can_focus">True</property>
                             <property name="receives_default">False</property>
                             <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                            <property name="use_action_appearance">False</property>
                             <property name="draw_indicator">True</property>
                           </object>
                           <packing>
@@ -145,7 +195,6 @@
                             <property name="can_focus">True</property>
                             <property name="receives_default">False</property>
                             <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                            <property name="use_action_appearance">False</property>
                             <property name="draw_indicator">True</property>
                           </object>
                           <packing>
@@ -161,7 +210,6 @@
                             <property name="can_focus">True</property>
                             <property name="receives_default">False</property>
                             <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                            <property name="use_action_appearance">False</property>
                             <property name="draw_indicator">True</property>
                           </object>
                           <packing>
@@ -220,12 +268,11 @@
                             <property name="can_focus">False</property>
                             <property name="spacing">6</property>
                             <child>
-                              <object class="GtkCheckButton" id="checkbutton_resources">
+                              <object class="GtkCheckButton" id="checkbox_resources">
                                 <property name="label" translatable="yes">Use less resources</property>
                                 <property name="visible">True</property>
                                 <property name="can_focus">True</property>
                                 <property name="receives_default">False</property>
-                                <property name="use_action_appearance">False</property>
                                 <property name="draw_indicator">True</property>
                               </object>
                               <packing>
@@ -241,7 +288,6 @@
                                 <property name="can_focus">True</property>
                                 <property name="receives_default">False</property>
                                 <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                                <property name="use_action_appearance">False</property>
                                 <property name="draw_indicator">True</property>
                               </object>
                               <packing>
@@ -271,6 +317,72 @@
                   </packing>
                 </child>
                 <child>
+                  <object class="GtkFrame" id="frame_maximus">
+                    <property name="visible">True</property>
+                    <property name="can_focus">False</property>
+                    <property name="label_xalign">0</property>
+                    <property name="shadow_type">none</property>
+                    <child>
+                      <object class="GtkAlignment" id="alignment7">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="top_padding">6</property>
+                        <property name="left_padding">12</property>
+                        <child>
+                          <object class="GtkVBox" id="vbox3">
+                            <property name="visible">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="spacing">6</property>
+                            <child>
+                              <object class="GtkCheckButton" id="checkbox_undecorate">
+                                <property name="label" translatable="yes">Undecorate maximized windows</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="position">0</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <object class="GtkCheckButton" id="checkbox_always_maximize">
+                                <property name="label" translatable="yes">Do not auto-maximize new windows</property>
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="receives_default">False</property>
+                                <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                <property name="draw_indicator">True</property>
+                              </object>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="padding">5</property>
+                                <property name="position">1</property>
+                              </packing>
+                            </child>
+                          </object>
+                        </child>
+                      </object>
+                    </child>
+                    <child type="label">
+                      <object class="GtkLabel" id="label_maximus">
+                        <property name="visible">True</property>
+                        <property name="can_focus">False</property>
+                        <property name="label" translatable="yes">&lt;b&gt;Maximus&lt;/b&gt;</property>
+                        <property name="use_markup">True</property>
+                      </object>
+                    </child>
+                  </object>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                    <property name="position">1</property>
+                  </packing>
+                </child>
+                <child>
                   <object class="GtkFrame" id="frame_marco2">
                     <property name="visible">True</property>
                     <property name="can_focus">False</property>
@@ -346,7 +458,7 @@
                   <packing>
                     <property name="expand">False</property>
                     <property name="fill">False</property>
-                    <property name="position">1</property>
+                    <property name="position">2</property>
                   </packing>
                 </child>
                 <child>
@@ -424,7 +536,7 @@
                   <packing>
                     <property name="expand">False</property>
                     <property name="fill">False</property>
-                    <property name="position">2</property>
+                    <property name="position">3</property>
                   </packing>
                 </child>
               </object>
@@ -532,6 +644,21 @@
                   </packing>
                 </child>
                 <child>
+                  <object class="GtkButton" id="button_save_panels">
+                    <property name="label" translatable="yes">Save Panel Layout</property>
+                    <property name="visible">True</property>
+                    <property name="can_focus">True</property>
+                    <property name="receives_default">True</property>
+                    <property name="tooltip_text" translatable="yes">Save your current panel layout.</property>
+                    <signal name="clicked" handler="save_panels" swapped="no"/>
+                  </object>
+                  <packing>
+                    <property name="expand">True</property>
+                    <property name="fill">True</property>
+                    <property name="position">1</property>
+                  </packing>
+                </child>
+                <child>
                   <object class="GtkFrame" id="frame8">
                     <property name="visible">True</property>
                     <property name="can_focus">False</property>
@@ -554,7 +681,6 @@
                                 <property name="visible">True</property>
                                 <property name="can_focus">True</property>
                                 <property name="receives_default">False</property>
-                                <property name="use_action_appearance">False</property>
                                 <property name="draw_indicator">True</property>
                               </object>
                               <packing>
@@ -569,7 +695,6 @@
                                 <property name="visible">True</property>
                                 <property name="can_focus">True</property>
                                 <property name="receives_default">False</property>
-                                <property name="use_action_appearance">False</property>
                                 <property name="draw_indicator">True</property>
                               </object>
                               <packing>
@@ -594,7 +719,7 @@
                   <packing>
                     <property name="expand">False</property>
                     <property name="fill">False</property>
-                    <property name="position">1</property>
+                    <property name="position">2</property>
                   </packing>
                 </child>
                 <child>
@@ -620,7 +745,6 @@
                                 <property name="visible">True</property>
                                 <property name="can_focus">True</property>
                                 <property name="receives_default">False</property>
-                                <property name="use_action_appearance">False</property>
                                 <property name="draw_indicator">True</property>
                               </object>
                               <packing>
@@ -635,7 +759,6 @@
                                 <property name="visible">True</property>
                                 <property name="can_focus">True</property>
                                 <property name="receives_default">False</property>
-                                <property name="use_action_appearance">False</property>
                                 <property name="draw_indicator">True</property>
                               </object>
                               <packing>
@@ -661,7 +784,7 @@
                   <packing>
                     <property name="expand">False</property>
                     <property name="fill">False</property>
-                    <property name="position">2</property>
+                    <property name="position">3</property>
                   </packing>
                 </child>
                 <child>
@@ -778,7 +901,7 @@
                   <packing>
                     <property name="expand">True</property>
                     <property name="fill">True</property>
-                    <property name="position">3</property>
+                    <property name="position">4</property>
                   </packing>
                 </child>
               </object>
@@ -807,57 +930,4 @@
       </object>
     </child>
   </object>
-  <object class="GtkListStore" id="model1">
-    <columns>
-      <!-- column-name gchararray -->
-      <column type="gchararray"/>
-    </columns>
-    <data>
-      <row>
-        <col id="0" translatable="yes">Left</col>
-      </row>
-      <row>
-        <col id="0" translatable="yes">Left (Inverted)</col>
-      </row>
-      <row>
-        <col id="0" translatable="yes">Right</col>
-      </row>
-    </data>
-  </object>
-  <object class="GtkListStore" id="model2">
-    <columns>
-      <!-- column-name gchararray -->
-      <column type="gchararray"/>
-    </columns>
-    <data>
-      <row>
-        <col id="0" translatable="yes">Test</col>
-      </row>
-    </data>
-  </object>
-  <object class="GtkListStore" id="model3">
-    <columns>
-      <!-- column-name gchararray -->
-      <column type="gchararray"/>
-    </columns>
-    <data>
-      <row>
-        <col id="0" translatable="yes">Test</col>
-      </row>
-    </data>
-  </object>
-  <object class="GtkListStore" id="model4">
-    <columns>
-      <!-- column-name gchararray -->
-      <column type="gchararray"/>
-    </columns>
-    <data>
-      <row>
-        <col id="0" translatable="yes">compiz</col>
-      </row>
-      <row>
-        <col id="0" translatable="yes">marco</col>
-      </row>
-    </data>
-  </object>
 </interface>
diff --git a/mate-tweak b/mate-tweak
index 169b36a..abd4af2 100755
--- a/mate-tweak
+++ b/mate-tweak
@@ -265,17 +265,19 @@ class MateTweak:
             target = self.sidePages[index].notebook_index
             self.builder.get_object("notebook1").set_current_page(target)
 
+    def save_panels(self, widget):
+        current_user = getpass.getuser()
+        print "Saving panel layout for " + current_user
+
     ''' Create the UI '''
     def __init__(self):
-        # load our glade ui file in
+        # Load the Glade UI file
         self.builder = Gtk.Builder()
-
-        # FIXME: this path should not be hard-coded!
         self.builder.add_from_file('/usr/lib/mate-tweak/mate-tweak.ui')
 
         self.window = self.builder.get_object( "main_window" )
-
         self.builder.get_object("main_window").connect("destroy", Gtk.main_quit)
+        self.builder.get_object("button_save_panels").connect("clicked", self.save_panels)
 
         side_desktop_options = SidePage(0, _("Desktop"), "user-desktop")
         side_windows = SidePage(1, _("Windows"), "preferences-system-windows")
@@ -290,11 +292,42 @@ class MateTweak:
         elif "Compiz" in current_wm:
             compiz_mode = True
 
+        # Determine what capabilities are available
+        indicators_available = False
+        if os.path.exists('/usr/lib/indicators/7/libapplication.so') and \
+           os.path.exists('/usr/lib/indicator-sound-gtk2/indicator-sound-service') and \
+           os.path.exists('/usr/lib/mate-indicator-applet/mate-indicator-applet'):
+            indicators_available = True
+
+        mate_menu_available = False
+        if os.path.exists('/usr/lib/mate-menu/mate-menu.py'):
+            mate_menu_available = True
+
+        mint_menu_available = False
+        if os.path.exists('usr/lib/linuxmint/mintMenu/mintMenu.py'):
+            mint_menu_available = True
+
+        gnome_menu_available = False
+        if os.path.exists('/usr/lib/gnome-main-menu/main-menu'):
+            gnome_menu_available = True
+
+        maximus_available = False
+        if os.path.exists('/usr/bin/mate-maximus') and \
+           os.path.exists('/usr/lib/mate-netbook/mate-window-picker-applet'):
+            maximus_available = True
+
+        dock = False
+        if os.path.exists('/usr/bin/docky') or os.path.exists('/usr/bin/plank'):
+            dock = True
+
         # Do not show Marco configuration options because Marco is not
         # currently running.
         if not marco_mode:
             self.builder.get_object("frame_marco1").hide()
 
+        if not maximus_available:
+            self.builder.get_object("frame_maximus").hide()
+
         if marco_mode or compiz_mode:
             # Show window manager configuration
             self.sidePages = [side_desktop_options, side_interface, side_windows]
@@ -328,6 +361,7 @@ class MateTweak:
         # i18n
         self.builder.get_object("label_desktop_icons").set_markup("<b>" + _("Desktop icons") + "</b>")
         self.builder.get_object("label_performance").set_markup("<b>" + _("Performance") + "</b>")
+        self.builder.get_object("label_maximus").set_markup("<b>" + _("Maximus") + "</b>")
         self.builder.get_object("label_appearance").set_markup("<b>" + _("Appearance") + "</b>")
         self.builder.get_object("label_icons").set_markup("<b>" + _("Icons") + "</b>")
         self.builder.get_object("label_context_menus").set_markup("<b>" + _("Context menus") + "</b>")
@@ -342,9 +376,12 @@ class MateTweak:
         self.builder.get_object("checkbox_trash").set_label(_("Trash"))
         self.builder.get_object("checkbox_volumes").set_label(_("Mounted Volumes"))
 
-        self.builder.get_object("checkbutton_resources").set_label(_("Don't show window content while dragging them"))
+        self.builder.get_object("checkbox_resources").set_label(_("Don't show window content while dragging them"))
         self.builder.get_object("checkbox_compositing").set_label(_("Use compositing"))
 
+        self.builder.get_object("checkbox_undecorate").set_label(_("Undecorate maximized windows"))
+        self.builder.get_object("checkbox_always_maximize").set_label(_("Do not auto-maximize new windows"))
+
         self.builder.get_object("label_layouts").set_text(_("Buttons layout:"))
         self.builder.get_object("label_window_manager").set_text(_("Window manager:"))
 
@@ -364,8 +401,10 @@ class MateTweak:
         self.init_checkbox("org.mate.caja.desktop", "volumes-visible", "checkbox_volumes")
 
         # Window Manager page
-        self.init_checkbox("org.mate.Marco.general", "reduced-resources", "checkbutton_resources")
+        self.init_checkbox("org.mate.Marco.general", "reduced-resources", "checkbox_resources")
         self.init_checkbox("org.mate.Marco.general", "compositing-manager", "checkbox_compositing")
+        self.init_checkbox("org.mate.maximus", "undecorate", "checkbox_undecorate")
+        self.init_checkbox("org.mate.maximus", "no-maximize", "checkbox_always_maximize")
 
         # interface page
         self.init_checkbox("org.mate.interface", "menus-have-icons", "checkbutton_menuicon")
@@ -396,33 +435,6 @@ class MateTweak:
         self.init_combobox("org.mate.session.required-components", "windowmanager", "combo_wm")
 
         # Panel layouts
-        indicators_available = False
-        if os.path.exists('/usr/lib/indicators/7/libapplication.so') \
-           and os.path.exists('/usr/lib/indicator-sound-gtk2/indicator-sound-service') \
-           and os.path.exists('/usr/lib/mate-indicator-applet/mate-indicator-applet'):
-               indicators_available = True
-
-        mate_menu_available = False
-        if os.path.exists('/usr/lib/mate-menu/mate-menu.py'):
-            mate_menu_available = True
-
-        mint_menu_available = False
-        if os.path.exists('usr/lib/linuxmint/mintMenu/mintMenu.py'):
-            mint_menu_available = True
-
-        gnome_menu_available = False
-        if os.path.exists('/usr/lib/gnome-main-menu/main-menu'):
-            gnome_menu_available = True
-
-        maximus_available = False
-        if os.path.exists('/usr/bin/mate-maximus') and
-           os.path.exists('/usr/lib/mate-netbook/mate-window-picker-applet'):
-            maximus_available = True
-
-        dock = False
-        if os.path.exists('/usr/bin/docky') or os.path.exists('/usr/bin/plank'):
-            dock = True
-
         panels = Gtk.ListStore(str, str)
 
         current_user = getpass.getuser()
@@ -466,45 +478,45 @@ class MateTweak:
             panels.append([_("Redmond with Indicators and MATE Menu"), "redmond-indicators-fresh"])
 
         if maximus_available:
-            if self.panel_layout_exists('netbook')
+            if self.panel_layout_exists('netbook'):
                 panels.append([_("Netbook"), "netbook"])
 
             if self.panel_layout_exists('netbook-fresh') \
                 and mate_menu_available:
                 panels.append([_("Netbook with MATE Menu"), "netbook-fresh"])
 
-            if self.panel_layout_exists('netbook-indicators') \
-                and indicators_available:
+            if self.panel_layout_exists('netbook-indicators') and \
+               indicators_available:
                 panels.append([_("Netbook with Indicators"), "netbook-indicators"])
 
-            if self.panel_layout_exists('netbook-indicators-fresh') \
-                and indicators_available \
-                and mate_menu_available:
+            if self.panel_layout_exists('netbook-indicators-fresh') and \
+               indicators_available and \
+               mate_menu_available:
                 panels.append([_("Netbook with Indicators and MATE Menu"), "netbook-indicators-fresh"])
 
         if dock:
             if self.panel_layout_exists('eleven'):
                 panels.append([_("Cupertino"), "eleven"])
 
-            if self.panel_layout_exists('eleven-fresh') \
-                and mate_menu_available:
+            if self.panel_layout_exists('eleven-fresh') and \
+               mate_menu_available:
                 panels.append([_("Cupertino with MATE Menu"), "eleven-fresh"])
 
-            if self.panel_layout_exists('eleven-indicators') \
-                and indicators_available:
+            if self.panel_layout_exists('eleven-indicators') and \
+               indicators_available:
                 panels.append([_("Cupertino with Indicators"), "eleven-indicators"])
 
-            if self.panel_layout_exists('eleven-indicators-fresh') \
-                and indicators_available \
-                and mate_menu_available:
+            if self.panel_layout_exists('eleven-indicators-fresh') and \
+                indicators_available and \
+                mate_menu_available:
                 panels.append([_("Cupertino with Indicators and MATE Menu"), "eleven-indicators-fresh"])
 
-        if self.panel_layout_exists('linuxmint') \
-            and mint_menu_available:
+        if self.panel_layout_exists('linuxmint') and \
+           mint_menu_available:
             panels.append([_("Linux Mint"), "linuxmint"])
 
-        if self.panel_layout_exists('opensuse') \
-            and gnome_menu_available:
+        if self.panel_layout_exists('opensuse') and \
+           gnome_menu_available:
             panels.append([_("openSUSE"), "opensuse"])
 
         self.builder.get_object("combobox_panels").set_model(panels)
-- 
2.1.1
